<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>service/cmd.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BackboneClient.html">BackboneClient</a><ul class='methods'><li data-type='method'><a href="BackboneClient.html#connect">connect</a></li><li data-type='method'><a href="BackboneClient.html#disconnect">disconnect</a></li><li data-type='method'><a href="BackboneClient.html#getEndpoint">getEndpoint</a></li><li data-type='method'><a href="BackboneClient.html#send">send</a></li></ul></li><li><a href="BackboneClientMessage.html">BackboneClientMessage</a><ul class='methods'><li data-type='method'><a href="BackboneClientMessage.html#getReply">getReply</a></li><li data-type='method'><a href="BackboneClientMessage.html#parseReply">parseReply</a></li><li data-type='method'><a href="BackboneClientMessage.html#parseResponse">parseResponse</a></li><li data-type='method'><a href="BackboneClientMessage.html#serialize">serialize</a></li></ul></li><li><a href="BackboneService.html">BackboneService</a><ul class='methods'><li data-type='method'><a href="BackboneService.html#connect">connect</a></li></ul></li><li><a href="CmdService.html">CmdService</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">service/cmd.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/**
 * @fileoverview Service that takes a command line and arguments and turns it into a service
 * @author &lt;gabe@dispatchr.co> (Gabriel Littman)
 */


var Service = require('./service');
var exec = require('child_process').exec;

class CmdService extends Service {
  /**
   * @constructor
   * @param {String} service name of the service
   * @param {String} cmd name of the programe to run
   * @param {String} host host name or ip of broker 
   * @param {String} port port to for service to connect to
   * @param {Array} options list or command line options to add to command
   */
  constructor(service, cmd, host, port, options) {
    console.log("CmdService", service, host, port, cmd, options);
    super(service, function(msg, reply){
      
      var full_cmd = options.concat(msg);
      full_cmd.unshift(cmd);
      full_cmd = full_cmd.join(' ');
      
      console.log("COMMAND", full_cmd);
      exec(full_cmd, function(error, stdout, stderr) {
          if(error) {
            reply(["Error", error]);
            console.error("error", error);
            console.error(`stderr: ${stderr}`);
          } else {
            reply(stdout);
          }          
      });
    }, {host: host, port: port});
  }
    
  
}

function service(name, cmd, args, opts){
  // console.log("service", name, cmd, args, opts);
  var host = opts.host;
  var port = opts.port;
  
  delete opts.host;
  delete opts.port;
  
  host = host || "127.0.0.1";
  port = port || "5555";

  for(var key in opts) {
    if(opts.hasOwnProperty(key)) {
      if(key.length === 1) {
        args.push('-'+key);
      } else {
        args.push('--'+key);
      }
      var val = opts[key];
      if(val !== true &amp;&amp; val !== false) {
        args.push(val);
      }
    }
  }
  var worker = new CmdService(name, cmd, host, port, args);
  worker.connect();   
}

function run() {
  var baker = require('dsp_shared/lib/baker');  
  baker.command(service, {args: "args", opts: "opts", default: true});
  baker.run();  
}

module.exports = {CmdService: CmdService, run: run};

if (require.main === module) {
  run();
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Nov 17 2016 16:49:04 GMT-0800 (PST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
