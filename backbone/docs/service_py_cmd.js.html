<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>service/py_cmd.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BackboneClient.html">BackboneClient</a><ul class='methods'><li data-type='method'><a href="BackboneClient.html#connect">connect</a></li><li data-type='method'><a href="BackboneClient.html#disconnect">disconnect</a></li><li data-type='method'><a href="BackboneClient.html#getEndpoint">getEndpoint</a></li><li data-type='method'><a href="BackboneClient.html#send">send</a></li></ul></li><li><a href="BackboneClientMessage.html">BackboneClientMessage</a><ul class='methods'><li data-type='method'><a href="BackboneClientMessage.html#getReply">getReply</a></li><li data-type='method'><a href="BackboneClientMessage.html#parseReply">parseReply</a></li><li data-type='method'><a href="BackboneClientMessage.html#parseResponse">parseResponse</a></li><li data-type='method'><a href="BackboneClientMessage.html#serialize">serialize</a></li></ul></li><li><a href="BackboneService.html">BackboneService</a><ul class='methods'><li data-type='method'><a href="BackboneService.html#connect">connect</a></li></ul></li><li><a href="CmdService.html">CmdService</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">service/py_cmd.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Utilities to start a command through the python command line service implementation
 */





var process = require('process');
var spawn = require('child_process').spawn;
var _ = require('underscore');



var NODE_PROCESS = 'node';

function start_node_service(service_name, node_file, options, host, port) {
  options = options || {};
  options.argv = options.argv || [];
  options.argv.unshift(node_file);
  start_service(service_name, NODE_PROCESS, options, host, port);
}

function compose_message(options) {
  var message = [];
  for(var key in options) {
    if(options.hasOwnProperty(key)) {
      message.push("--"+key);
      message.push(options[key]);
    }
  }  
  return message;
}


function start_service(service_name, command, options, host, port) {
  var py_options = ['host', 'port'];
  var cmd_argv;
  
  if(Array.isArray(options)) {
    py_options = {};
    cmd_argv = options;
  } else {
    cmd_argv = options.argv || [];
    var test = compose_message(_.omit(options, py_options.concat('argv')));
    cmd_argv.push.apply(cmd_argv, test);
    py_options   = _.pick(options, py_options);
  }
  
  if(host) {
    py_options.host = host;
  }
  if(port) {
    py_options.port = port;
  }
  var py_argv = compose_message(py_options);
  
  var full_argv = [];
  full_argv.push('-u');  
  full_argv.push('-m');  
  full_argv.push('backbone.service'); 
  full_argv.push.apply(full_argv, py_argv);  
  full_argv.push(service_name);  
  full_argv.push(command);  
  full_argv.push.apply(full_argv, cmd_argv);  
  
  
  // console.log(["python"].concat(full_argv).join(' '));
  var child = spawn('python', full_argv);
  
  child.stdout.pipe(process.stdout);
  child.stderr.pipe(process.stderr);
  
}

module.exports = {
  start: start_service,
  start_node: start_node_service
};


if (require.main === module) {
  var baker = require('dsp_shared/lib/baker');  
  baker.command(start_service, {default: true, opts: 'options', command: 'start'});
  baker.command(start_node_service, {opts: 'options', command: 'start_node'});
  baker.run();
}

// if (require.main === module) {
//   var params = process.argv.slice(2);
//   console.log("LLLLLLL", params);
//   var service_name = params.shift();
//   var command = params.shift();
//
//
// }</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Nov 17 2016 16:49:04 GMT-0800 (PST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
